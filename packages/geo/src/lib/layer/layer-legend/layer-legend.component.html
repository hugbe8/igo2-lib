<ng-container *ngIf="legendItems$ | async as items">
  <ng-container *ngIf="items.length; else noItems">
    <ng-container *ngFor="let item of items">
      <mat-list-item *ngIf="item.title">
        <mat-icon
          id="legend-toggle"
          class="igo-chevron"
          mat-list-avatar
          igoCollapse
          [target]="legend"
          [collapsed]="false"
          svgIcon="chevron-up">
        </mat-icon>
        <h4 matLine>{{item.title}}</h4>
      </mat-list-item>  
      <mat-list-item *ngIf="currentStyle">
        <mat-select tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="'igo.geo.sourceFields.selectField' | translate"
          [(ngModel)]="currentStyle" (selectionChange)="onChangeStyle()">
          <mat-option *ngFor="let style of listStyles()" [value]="style.name">{{style.title}}</mat-option>
        </mat-select>
      </mat-list-item>
      <div #legend class="igo-layer-legend" [ngClass]="{'with-title': item.title}">
        <img #renderedLegend (load)="onLoadImage()"
          *ngIf="item.url"
          src="{{(item.url | secureImage) |Â async}}"
          alt="{{'igo.geo.layer.loadingLegendText' | translate}}"
        >
        <small *ngIf="item.url && imgHeight<16">
            {{'igo.geo.layer.noLegendScale' | translate}}
        </small>
        <div
          [ngStyle]="item.style"
          [innerHTML]="item.html"
          *ngIf="item.html">
        </div>
      </div>
    </ng-container>
  </ng-container>

  <ng-template #noItems>
    <small>
      {{'igo.geo.layer.noLegendText' | translate}}
    </small>
  </ng-template>

</ng-container>
